{% extends "base.html" %}

{% block content %}
<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <div>
      <h2 class="h4 mb-1">
        Calendário – {{ month_name }} de {{ year }}
      </h2>
      <p class="text-muted mb-0 small">
        Visualize os lançamentos de animes por dia.
      </p>
    </div>

    <div class="d-flex gap-2">
      <a href="{% url 'calendar_app:month_view' year=prev_year month=prev_month %}"
         class="btn btn-outline-light btn-sm">
        <i class="bi bi-chevron-left"></i> Mês anterior
      </a>
      <a href="{% url 'calendar_app:month_view' year=next_year month=next_month %}"
         class="btn btn-outline-light btn-sm">
        Próximo mês <i class="bi bi-chevron-right"></i>
      </a>
      <a href="{% url 'calendar_app:month_current' %}"
         class="btn btn-primary btn-sm">
        Hoje
      </a>
    </div>
  </div>

  <div class="table-responsive">
    <table class="table table-dark table-bordered align-middle text-center mb-0"
           style="border-color: rgba(148,163,184,.3);">
      <thead>
        <tr style="background:#020617;">
          <th class="small text-uppercase">Dom</th>
          <th class="small text-uppercase">Seg</th>
          <th class="small text-uppercase">Ter</th>
          <th class="small text-uppercase">Qua</th>
          <th class="small text-uppercase">Qui</th>
          <th class="small text-uppercase">Sex</th>
          <th class="small text-uppercase">Sáb</th>
        </tr>
      </thead>
      <tbody>
        {% for week in weeks %}
          <tr>
            {% for day in week %}
              <td
                class="p-1 align-top"
                style="
                  background-color:#020617;
                  border-width:1px;
                  border-style:solid;
                  border-color:
                    {% if day.is_today %}
                      #38bdf8
                    {% elif day.in_month %}
                      rgba(148,163,184,.3)
                    {% else %}
                      rgba(148,163,184,.15)
                    {% endif %};
                  {% if not day.in_month %}opacity:.35;{% endif %}
                "
              >
                {% if day.date %}
                  <!-- Número do dia -->
                  <div class="d-flex justify-content-between align-items-center mb-1">
                    <span class="fw-semibold small">
                      {{ day.date.day }}
                    </span>

                    {% if day.is_today %}
                      <span class="badge bg-info text-dark small">
                        Hoje
                      </span>
                    {% endif %}
                  </div>

                  <!-- Lista de animes / episódios -->
                  {% if day.airings %}
                    <ul class="list-unstyled mb-0" style="font-size: .75rem;">
                      {% for airing in day.airings %}
                        <li class="text-start mb-1">
                          <span class="badge bg-secondary me-1">
                            {{ airing.anime.title|truncatechars:18 }}
                          </span>
                          {% if airing.airing_time %}
                            <span class="text-muted">
                              {{ airing.airing_time|time:"H:i" }}
                            </span>
                          {% endif %}
                        </li>
                      {% endfor %}
                    </ul>
                  {% endif %}
                {% endif %}
              </td>
            {% endfor %}
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <p class="mt-3 text-muted small">
    * Dias fora do mês atual aparecem com menor opacidade.
  </p>
</div>
{% endblock %}
